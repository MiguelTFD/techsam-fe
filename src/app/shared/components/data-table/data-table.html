<div class="data-table">
  <!-- Header -->
  <div class="data-table__header">
    <h2 class="data-table__title">Dulces Datos</h2>
    
    <div class="data-table__controls">
      <!-- Búsqueda -->
      <div class="data-table__search">
        <i-lucide [img]="icons.search" class="data-table__search-icon"></i-lucide>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          [placeholder]="search.placeholder"
          class="data-table__search-input">
        <button 
          *ngIf="searchTerm" 
          (click)="clearSearch()"
          class="data-table__search-clear">
          <i-lucide [img]="icons.x" class="data-table__search-icon"></i-lucide>
        </button>
      </div>

      <div class="data-table__buttons">
        <!-- Botón Exportar -->
        <app-export-button
          *ngIf="showExportButton"
          [title]="exportTitle"
          [fileName]="exportFileName"
          [stats]="exportStats"
          (export)="onExport()"
          class="data-table__button data-table__button--secondary">
          <i-lucide [img]="icons.download" class="data-table__button-icon"></i-lucide>
          Exportar
        </app-export-button>

        <!-- Botón Añadir -->
        <button
          *ngIf="showAddButton"
          (click)="onAdd()"
          class="data-table__button data-table__button--primary">
          <i-lucide [img]="icons.plus" class="data-table__button-icon"></i-lucide>
          {{ addButtonLabel }}
        </button>
      </div>
    </div>
  </div>

  <!-- Contenedor de la tabla -->
  <div class="data-table__table-container">
    <!-- Loading State -->
    <div *ngIf="loading" class="data-table__loading">
      <i-lucide [img]="icons.loader" class="data-table__loading-icon"></i-lucide>
      Cargando datos dulces...
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && data.length === 0" class="data-table__empty">
      <i-lucide [img]="icons.cupcake" class="data-table__empty-icon"></i-lucide>
      <div class="data-table__empty-title">¡No hay datos!</div>
      <div class="data-table__empty-message">
        {{ searchTerm ? 'No se encontraron resultados para tu búsqueda' : 'Comienza añadiendo algunos datos' }}
      </div>
    </div>

    <!-- Tabla -->
    <table *ngIf="!loading && data.length > 0" class="data-table__table">
      <thead class="data-table__thead">
        <tr>
          <th 
            *ngFor="let column of columns"
            [class.data-table__th--sortable]="column.sortable"
            (click)="onSort(column)"
            class="data-table__th">
            
            <div class="data-table__th-content">
              {{ column.label }}
              <i-lucide 
                *ngIf="column.sortable"
                [img]="sortColumn === column.key ? 
                       (sortDirection === 'asc' ? icons.arrowUp : icons.arrowDown) : 
                       icons.arrowUpDown"
                [class.data-table__th-icon--active]="sortColumn === column.key"
                class="data-table__th-icon">
              </i-lucide>
            </div>
          </th>
          
          <th *ngIf="showActions" class="data-table__th">Acciones</th>
        </tr>
      </thead>
      
      <tbody class="data-table__tbody">
        <tr 
          *ngFor="let row of data; trackBy: trackByFn"
          (click)="onRowClick(row)"
          class="data-table__tr">
          
          <td *ngFor="let column of columns" class="data-table__td">
            <ng-container *ngIf="!column.template; else customTemplate">
              {{ row[column.key] }}
            </ng-container>
            <ng-template #customTemplate>
              <ng-container *ngTemplateOutlet="column.template; context: { $implicit: row }"></ng-container>
            </ng-template>
          </td>
          
          <td *ngIf="showActions" class="data-table__td">
            <div class="data-table__actions">
              <button
                *ngFor="let action of actions"
                (click)="onAction(action.name, row, $event)"
                [attr.data-tooltip]="action.label"
                class="data-table__action"
                [style.color]="action.color ? action.color : '#ff6bb8'">
                
                <i-lucide 
                  [img]="getActionIcon(action.name)" 
                  class="data-table__action-icon">
                </i-lucide>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div *ngIf="!loading && data.length > 0" class="data-table__pagination">
    <div class="data-table__pagination-info">
      Mostrando {{ displayRangeStart }} - {{ displayRangeEnd }} de {{ pagination.total }} registros
    </div>
    
    <div class="data-table__pagination-controls">
      <button
        (click)="goToPage(1)"
        [disabled]="pagination.page === 1"
        class="data-table__pagination-button">
        <i-lucide [img]="icons.chevronsLeft" class="data-table__pagination-button-icon"></i-lucide>
      </button>
      
      <button
        (click)="goToPage(pagination.page - 1)"
        [disabled]="pagination.page === 1"
        class="data-table__pagination-button">
        <i-lucide [img]="icons.chevronLeft" class="data-table__pagination-button-icon"></i-lucide>
      </button>

      <div class="data-table__pagination-pages">
        <button
          *ngFor="let page of visiblePages"
          (click)="goToPage(page)"
          [class.data-table__pagination-button--active]="page === pagination.page"
          class="data-table__pagination-button">
          {{ page }}
        </button>
      </div>

      <button
        (click)="goToPage(pagination.page + 1)"
        [disabled]="pagination.page === totalPages"
        class="data-table__pagination-button">
        <i-lucide [img]="icons.chevronRight" class="data-table__pagination-button-icon"></i-lucide>
      </button>
      
      <button
        (click)="goToPage(totalPages)"
        [disabled]="pagination.page === totalPages"
        class="data-table__pagination-button">
        <i-lucide [img]="icons.chevronsRight" class="data-table__pagination-button-icon"></i-lucide>
      </button>
    </div>
  </div>
</div>